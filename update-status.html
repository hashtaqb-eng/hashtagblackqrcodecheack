<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: Cairo;
  background: #0f0f0f;
  color: #fff;
  padding: 20px;
  direction: rtl;
}

.box {
  max-width: 400px;
  margin: auto;
  background: #151515;
  border-radius: 16px;
  padding: 25px;
  text-align: center;
}

select, button {
  width: 100%;
  padding: 14px;
  margin-top: 15px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}

select {
  background: #222;
  color: #fff;
}

button {
  background: #ff0055;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

.msg {
  margin-top: 20px;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="box">
  <h2>ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
  <div id="orderInfo"></div>

  <select id="status">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
    <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²">ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>
    <option value="Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†">ğŸšš Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†</option>
    <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">âœ… ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
    <option value="ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡">âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</option>
  </select>

  <button onclick="updateStatus()">Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©</button>
  <div class="msg" id="msg"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyE96Kn9qqPLdUm6iC2n7QPfMryGXYFB8GSdVCDSmBbZzsO7iMyIfZhsTTERD_Y_-pf1Q/exec";

const params = new URLSearchParams(window.location.search);
const orderId = params.get("orderId");

if (!orderId) {
  document.body.innerHTML = "<h2 style='color:red;text-align:center'>âŒ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</h2>";
  throw new Error("NO_ORDER_ID");
}

document.getElementById("orderInfo").innerText = "Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: " + orderId;

function updateStatus() {
  const status = document.getElementById("status").value;
  if (!status) {
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„Ø©");
    return;
  }

  // Ø·Ù„Ø¨ PIN Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const pin = prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ PIN Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:");
  if (!pin) return; // Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„ØºØ§Ø¡

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ PIN Ù„Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙ‚Ø·
  fetch(`${API}?action=updateStatus&orderId=${encodeURIComponent(orderId)}&status=${encodeURIComponent(status)}&pin=${encodeURIComponent(pin)}`)
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        document.getElementById("msg").innerText = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­";
      } else {
        document.getElementById("msg").innerText = "âŒ " + (data.message || "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
      }
    })
    .catch(() => {
      document.getElementById("msg").innerText = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±";
    });
}
</script>

</body>
</html>
