<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: Cairo, sans-serif;
  background: #0f0f0f;
  color: #fff;
  margin: 0;
  padding: 0;
  direction: rtl;
}

.container {
  max-width: 600px;
  margin: 40px auto;
  background: #111;
  border-radius: 16px;
  padding: 25px;
  border: 1px solid #333;
}

h1 {
  text-align: center;
  color: #ff0055;
}

.input-box {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

input {
  flex: 1;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid #333;
  background: #1a1a1a;
  color: #fff;
}

button {
  padding: 14px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.btn-check {
  background: #ff0055;
  color: #fff;
}

.card {
  margin-top: 25px;
  background: #181818;
  border-radius: 14px;
  padding: 20px;
  display: none;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #222;
}

.status {
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: bold;
  display: inline-block;
}

.paid { background:#2ecc71; color:#000; }
.pending { background:#f1c40f; color:#000; }
.cancelled { background:#e74c3c; color:#fff; }

.actions {
  margin-top: 20px;
  display: flex;
  gap: 10px;
}

.action-btn {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

.pay {
  background: #00c853;
  color: #000;
}

.whatsapp {
  background: #25D366;
  color: #000;
}

.call {
  background: #007bff;
  color: #fff;
}

.error {
  margin-top: 20px;
  color: #ff5555;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">
  <h1>ğŸ” ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</h1>

  <div class="input-box">
    <input id="orderInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
    <button class="btn-check" onclick="checkOrder()">Ø¨Ø­Ø«</button>
  </div>

  <div id="error" class="error"></div>

  <div id="orderCard" class="card">
    <div class="row"><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b><span id="o_id"></span></div>
    <div class="row"><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b><span id="o_date"></span></div>
    <div class="row"><b>Ø§Ù„Ø§Ø³Ù…:</b><span id="o_name"></span></div>
    <div class="row"><b>Ø§Ù„Ù‡Ø§ØªÙ:</b><span id="o_phone"></span></div>
    <div class="row"><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b><span id="o_total"></span></div>
    <div class="row"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b><span id="o_status"></span></div>

    <div class="actions" id="actions"></div>
   <button class="action-btn" style="background:#555;color:#fff" onclick="openAdmin()">
ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ÙˆØ¤Ù„
</button>

  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyE96Kn9qqPLdUm6iC2n7QPfMryGXYFB8GSdVCDSmBbZzsO7iMyIfZhsTTERD_Y_-pf1Q/exec";  

function checkOrder() {
  const id = document.getElementById("orderInput").value.trim();
  if (!id) {
    showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨");
    return;
  }

  fetch(`${API_URL}?action=getOrder&orderId=${encodeURIComponent(id)}`)
    .then(res => {
      if (!res.ok) throw new Error("NETWORK");
      return res.json();
    })
    .then(data => {
      if (!data || data.success !== true || !data.order) {
        showError("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨");
        return;
      }

      const o = data.order;

      document.getElementById("error").innerText = "";
      document.getElementById("orderCard").style.display = "block";

      document.getElementById("o_id").innerText = o.orderId;
      document.getElementById("o_date").innerText = o.date || "-";
      document.getElementById("o_name").innerText = o.customerName || "-";
      document.getElementById("o_phone").innerText = o.customerPhone || "-";
      document.getElementById("o_total").innerText = (o.total || 0) + " AED";

      const statusEl = document.getElementById("o_status");
      statusEl.textContent = o.status || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

      if ((o.status || "").includes("Ù…Ø¯ÙÙˆØ¹")) {
        statusEl.className = "status paid";
      } else {
        statusEl.className = "status pending";
      }

      renderActions(o);
    })
    .catch(() => {
      showError("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
    });
}

function renderActions(order) {
  const box = document.getElementById("actions");
  box.innerHTML = "";

  if (!order.status.includes("Ù…Ø¯ÙÙˆØ¹")) {
    const payBtn = document.createElement("button");
    payBtn.className = "action-btn pay";
    payBtn.innerText = "ğŸ’³ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹";
  payBtn.onclick = () => {
  const uniqueRef = order.orderId + "-" + Date.now();
  window.location.href = `${API_URL}?action=payment&orderId=${uniqueRef}&baseOrder=${order.orderId}&amount=${order.total}`;
};
    box.appendChild(payBtn);
  }

  const wa = document.createElement("button");
  wa.className = "action-btn whatsapp";
  wa.innerText = "ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨";
  wa.onclick = () => {
    window.open(`https://wa.me/971XXXXXXXX?text=Ù…Ø±Ø­Ø¨Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${order.orderId}`, "_blank");
  };

  const call = document.createElement("button");
  call.className = "action-btn call";
  call.innerText = "ğŸ“ Ø§ØªØµØ§Ù„";
  call.onclick = () => window.location.href = "tel:+971XXXXXXXX";

  box.appendChild(wa);
  box.appendChild(call);
}

function showError(msg) {
  document.getElementById("error").innerText = msg;
  document.getElementById("orderCard").style.display = "none";
}
  // Ù‚Ø±Ø§Ø¡Ø© Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (QR)
window.onload = function () {
  const params = new URLSearchParams(window.location.search);
  const orderId = params.get("orderId");

  if (orderId) {
    document.getElementById("orderInput").value = orderId;
    checkOrder();
  }
};
function openAdmin() {
  const pin = prompt("Ø£Ø¯Ø®Ù„ PIN Ø§Ù„Ù…ÙˆØ¸Ù:");
  if (!pin) return;

  // PIN Ø«Ø§Ø¨Øª
  if (pin === "1234") {
    const orderId = document.getElementById("o_id").innerText;
   window.location.href =
  "/admin/update-status.html?orderId=" + encodeURIComponent(orderId) + "&pin=" + pin;

  } else {
    alert("âŒ PIN ØºÙŠØ± ØµØ­ÙŠØ­");
  }
}
</script>

</body>
</html>
