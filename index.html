<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: Cairo, sans-serif;
  background: #0f0f0f;
  color: #fff;
  margin: 0;
  padding: 0;
  direction: rtl;
}

.container {
  max-width: 600px;
  margin: 40px auto;
  background: #111;
  border-radius: 16px;
  padding: 25px;
  border: 1px solid #333;
}

h1 {
  text-align: center;
  color: #ff0055;
}

.input-box {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

input {
  flex: 1;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid #333;
  background: #1a1a1a;
  color: #fff;
}

button {
  padding: 14px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.btn-check {
  background: #ff0055;
  color: #fff;
}

.card {
  margin-top: 25px;
  background: #181818;
  border-radius: 14px;
  padding: 20px;
  display: none;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #222;
}

.status {
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: bold;
}

.paid { background:#2ecc71; color:#000; }
.pending { background:#f1c40f; color:#000; }

.actions {
  margin-top: 20px;
  display: flex;
  gap: 10px;
}

.action-btn {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
}

.pay { background:#00c853; color:#000; }
.whatsapp { background:#25D366; color:#000; }
.call { background:#007bff; color:#fff; }

#error {
  margin-top: 20px;
  color: #ff5555;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">
  <h1 id="title">ğŸ” ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</h1>

  <div class="input-box">
    <input id="orderInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
    <button class="btn-check" onclick="checkOrder()">Ø¨Ø­Ø«</button>
  </div>

  <div id="error"></div>

  <div id="orderCard" class="card">
    <div class="row"><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b><span id="o_id"></span></div>
    <div class="row"><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b><span id="o_date"></span></div>
    <div class="row"><b>Ø§Ù„Ø§Ø³Ù…:</b><span id="o_name"></span></div>
    <div class="row"><b>Ø§Ù„Ù‡Ø§ØªÙ:</b><span id="o_phone"></span></div>
    <div class="row"><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b><span id="o_total"></span></div>
    <div class="row"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b><span id="o_status" class="status"></span></div>

    <div class="actions" id="actions"></div>

    <!-- Ø²Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Ù…Ø®ÙÙŠ) -->
    <button id="adminBtn"
      class="action-btn"
      style="display:none;background:#444;color:#fff"
      onclick="openAdmin()">
      ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
    </button>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzTjxU3U8t0JcpbBTQjLJEbkI2Ll67rQ3GOnb77yPGfj49udH8e8UoqJXyaKo0ISliXRA/exec";
  
/* ====== Ø¯Ø¹Ù… QR ====== */
const urlParams = new URLSearchParams(window.location.search);
const scannedOrderId = urlParams.get("orderId");

if (scannedOrderId) {
  const input = document.getElementById("orderInput");
  input.value = scannedOrderId;

  // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  setTimeout(() => {
    checkOrder();
  }, 300);
}

// Ø¯Ø¹Ù… Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ‘Ù„ Ù„Ù„Ù…Ø§ÙˆØ³ ÙˆØ§Ù„Ù„Ù…Ø³
let pressTimer;
const title = document.getElementById("title");

function startPressTimer() {
  pressTimer = setTimeout(() => {
    document.getElementById("adminBtn").style.display = "block";
  }, 3000);
}

function cancelPressTimer() {
  clearTimeout(pressTimer);
}

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³
title.addEventListener("mousedown", startPressTimer);
title.addEventListener("mouseup", cancelPressTimer);
title.addEventListener("mouseleave", cancelPressTimer);

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³
title.addEventListener("touchstart", startPressTimer);
title.addEventListener("touchend", cancelPressTimer);
title.addEventListener("touchcancel", cancelPressTimer);

function checkOrder() {
  const id = document.getElementById("orderInput").value.trim();
  if (!id) return showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨");

  fetch(`${API_URL}?action=getOrder&orderId=${encodeURIComponent(id)}`)
    .then(r => r.json())
    .then(d => {
      if (!d.success) return showError("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨");

      const o = d.order;
      document.getElementById("orderCard").style.display = "block";
      document.getElementById("error").innerText = "";

      o_id.innerText = o.orderId;
      o_date.innerText = o.date || "-";
      o_name.innerText = o.customerName || "-";
      o_phone.innerText = o.customerPhone || "-";
      o_total.innerText = (o.total || 0) + " AED";
      o_status.innerText = o.status || "-";
      o_status.className = "status " + (o.status.includes("Ù…Ø¯ÙÙˆØ¹") ? "paid" : "pending");

      renderActions(o);
    })
    .catch(() => showError("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"));
}

function renderActions(order) {
  const box = document.getElementById("actions");
  box.innerHTML = "";

  if (!order.status.includes("Ù…Ø¯ÙÙˆØ¹")) {
    const pay = document.createElement("button");
    pay.className = "action-btn pay";
    pay.innerText = "ğŸ’³ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹";
    pay.onclick = () => {
      const ref = order.orderId + "-" + Date.now();
      window.location.href =
        `${API_URL}?action=payment&orderId=${ref}&baseOrder=${order.orderId}&amount=${order.total}`;
    };
    box.appendChild(pay);
  }

  const wa = document.createElement("button");
  wa.className = "action-btn whatsapp";
  wa.innerText = "ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨";
  wa.onclick = () => {
    const msg = `Ù…Ø±Ø­Ø¨Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${order.orderId}`;
    window.open(`https://wa.me/96877586062?text=${encodeURIComponent(msg)}`, "_blank");
  };
  box.appendChild(wa);

  const call = document.createElement("button");
  call.className = "action-btn call";
  call.innerText = "ğŸ“ Ø§ØªØµØ§Ù„";
  call.onclick = () => window.location.href = "tel:+96877586062";
  box.appendChild(call);
}

function openAdmin() {
  const pin = prompt("Ø£Ø¯Ø®Ù„ PIN Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:");
  if (!pin) return;

  fetch(`${API_URL}?action=verifyPin&pin=${encodeURIComponent(pin)}`)
    .then(r => r.json())
    .then(d => {
      if (d.success) {
        window.location.href =
          "https://hashtaqb-eng.github.io/hashtagblackqrcodecheack/update-status.html"
          + "?orderId=" + encodeURIComponent(o_id.innerText);
      } else {
        alert("âŒ PIN ØºÙŠØ± ØµØ­ÙŠØ­");
      }
    });
}

function showError(msg) {
  document.getElementById("error").innerText = msg;
  document.getElementById("orderCard").style.display = "none";
}
</script>

</body>
</html>


